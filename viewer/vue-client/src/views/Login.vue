<script>
import { mapGetters } from 'vuex';

export default {
  name: 'Login',
  data() {
    return {
      showButton: false,
      failedLogin: false,
      loginExpired: false,
    };
  },
  watch: {
  },
  computed: {
    ...mapGetters([
      'inspector',
      'resources',
      'user',
      'settings',
      'status',
    ]),
  },
  methods: {
    renewLogin() {
      window.location = `${this.settings.apiPath}/login/authorize`;
    },
  },
  mounted() {
    this.$nextTick(() => {
      const token = localStorage.getItem('at');
      if (this.$route.params.state === 'expired') {
        this.loginExpired = true;
      } else if (this.user.isLoggedIn && token !== null) {
        const path = localStorage.getItem('lastPath') || '/';
        this.$router.push({ path: path });
      } else window.location = `${this.settings.apiPath}/login/authorize`;
    });
  },
};
</script>

<template>
  <div class="Login">
    <div class="Login-content" v-if="failedLogin">
      {{ 'Something went wrong' | translatePhrase }}
    </div>
    <div class="Login-content" v-if="loginExpired">
      {{ 'Your login has expired' | translatePhrase }}.
      <hr>
      <button class="btn-primary btn--md" @click="renewLogin" @keyup.enter="renewLogin">
        {{ 'Renew' | translatePhrase }}
      </button>
    </div>
  </div>
</template>

<style lang="less">

.Login {
  display: flex;
  flex-direction: row;
  justify-content: center;
  &-content {
    display: flex;
    flex-wrap: wrap;
    flex-direction: column;
    justify-content: space-around;
    padding: 20px;
    background-color: @white;
    border-radius: 4px;
    box-shadow: @shadow-panel;
  }
}
</style>
